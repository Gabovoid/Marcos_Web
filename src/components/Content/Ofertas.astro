---
import { Image } from "astro:assets";
import sayonara from "../../assets/Sayonara.webp";
import thriller from "../../assets/Thriller.webp";
import mbf from "../../assets/MBF.webp";

const products = [
  { id: 1, title: "Sayonara [2LP] (Silver Vinyl)", realprice: "S/ 190.00", price: "S/ 190.00", image: sayonara },
  { id: 2, title: "Thriller [LP]", realprice: "S/ 139.00", price: "S/ 190.00", image: thriller },
  { id: 3, title: "Man's Best Friend Vinilo Blanco Exclusivo", realprice: "S/ 199.00", price: "S/ 190.00", image: mbf },
  { id: 4, title: "Producto 4", realprice: "S/ 180.00", price: "S/ 190.00", image: sayonara },
  { id: 5, title: "Producto 5", realprice: "S/ 210.00", price: "S/ 190.00", image: sayonara },
  { id: 6, title: "Producto 6", realprice: "S/ 175.00", price: "S/ 190.00", image: sayonara },
];
---

<section class="bg-[#1A1A1A] text-white py-25 relative">
  <h2 class="text-center text-2xl font-bold font-sans mb-6">OFERTAS IMPERDIBLES</h2>

  <!-- Botones solo visibles en desktop -->
  <div class="hidden lg:block lg:absolute left-0 -translate-y-1 z-10">
    <button id="btn-leftO" class="bg-[#161616] py-42 px-27 text-xl hover:bg-white hover:text-black transition disabled:opacity-40 cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="m12 19-7-7 7-7"/>
        <path d="M19 12H5"/>
      </svg>
    </button>
  </div>

  <div class="hidden lg:block lg:absolute right-0 -translate-y-1 z-10">
    <button id="btn-rightO" class="bg-[#161616] py-42 px-27 text-xl hover:bg-white hover:text-black transition disabled:opacity-40 cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M5 12h14"/>
        <path d="m12 5 7 7-7 7"/>
      </svg>
    </button>
  </div>

  <!-- Contenedor del slider -->
  <div class="overflow-x-auto lg:overflow-hidden max-w-5xl mx-auto mt-6 scrollbar-hide">
    <div id="sliderO" class="flex transition-transform duration-500 ease-in-out">
      {products.map((product) => (
        <div class="relative w-1/2 lg:w-1/3 flex-shrink-0 px-3 text-center">
          <a href="">

            <div class="relative aspect-square hover:scale-105 w-full overflow-hidden bg-black rounded-lg shadow">
              <Image 
                src={product.image} 
                alt={product.title} 
                class="w-full h-full object-cover" 
              />
              <p class="absolute top-2 right-2 bg-red-600 text-black text-xs font-semibold px-2 py-1 rounded-md">
                Oferta
              </p>
            </div>
            <p class="mt-2 text-sm text-center truncate w-full">{product.title}</p>
            <div class="flex items-center justify-center gap-2">
                <p class="font-semibold text-sm">{product.price}</p>
                <p class="font-light text-sm line-through">{product.realprice}</p>
            </div>
          </a>

          <button class="mt-3 w-full flex items-center justify-center gap-2 bg-white hover:bg-[#4d5645] text-black hover:text-white font-semibold py-2 rounded-lg transition cursor-pointer">
            Agregar
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 stroke-[2]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/>
              <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
            </svg>
          </button>
        </div>
      ))}
    </div>
  </div>
</section>

<div class="w-full h-[1px] bg-gradient-to-r from-transparent via-gray-400 to-transparent"></div>

<script is:inline>
const sliderO = document.getElementById("sliderO");
const btnLeftO = document.getElementById("btn-leftO");
const btnRightO = document.getElementById("btn-rightO");

if (btnLeftO && btnRightO) {
  let page = 0;
  const cardsVisible = 3;
  const totalCards = sliderO.children.length;
  const totalPages = Math.ceil(totalCards / cardsVisible);

  function updateSliderO() {
    const cardWidth = sliderO.children[0].offsetWidth;
    sliderO.style.transform = `translateX(-${page * cardWidth * cardsVisible}px)`;
    btnLeftO.disabled = page === 0;
    btnRightO.disabled = page === totalPages - 1;
  }

  btnLeftO.addEventListener("click", () => {
    if (page > 0) { page--; updateSliderO(); }
  });

  btnRightO.addEventListener("click", () => {
    if (page < totalPages - 1) { page++; updateSliderO(); }
  });

  updateSliderO();
}
</script>
